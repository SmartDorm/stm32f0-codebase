/*
 * alarm.c
 *
 *  Created on: Apr 24, 2018
 *      Author: jared
 */

#include "alarm.h"
#include "stm32f0xx_hal.h"

extern DAC_HandleTypeDef hdac1;

void update_alarm_value(int indx)
{
    uint32_t values[125] = {512, 537, 563, 588, 614, 639, 664, 688, 712, 735, 758, 780, 802, 823, 843, 862, 880, 898,
            914, 929, 944, 957, 969, 980, 990, 998, 100, 1012, 1017, 1020, 1022, 1023, 1023, 1022, 1019, 1014,
            1009, 1002, 994, 985, 975, 963, 951, 937, 922, 906, 889, 871, 852, 833, 812, 791, 769, 747, 724, 700,
            676, 651, 626, 601, 576, 550, 524, 499, 473, 447, 422, 397, 372, 347, 323, 299, 277, 254, 232, 211,
            190, 171, 152, 134, 117, 101, 86, 72, 60, 48, 38, 29, 21, 14, 9, 4, 1, 0, 0, 1, 3, 6, 11, 17, 25,
            33, 43, 54, 66, 79, 94, 109, 125, 143, 161, 180, 200, 221, 243, 265, 288, 311, 335, 359, 384, 409,
            435, 460, 486};

    HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_L, values[indx] << 2);
}

void stop_alarm()
{
    HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_1, DAC_ALIGN_8B_R, 0);
}
